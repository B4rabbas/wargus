#!/bin/sh

set -e

. /usr/share/debconf/confmodule

extract() {

	db_get wargus/extractdata || true
	if [ "$RET" != "true" ]; then
		db_stop || true
		return 0
	fi

	db_get wargus/cdpath || true
	if ! [ -d "$RET" ]; then
		db_stop || true
		echo "${RET} doesn't exist - can't extract Warcraft II data" >&2
		return 1
	fi

	CDPATH="$RET"
	ARGS=

	db_get wargus/extractmidi || true
	if [ "$RET" = "true" ]; then
		ARGS="$ARGS -m"
	fi

	db_get wargus/extractvideo || true
	if [ "$RET" = "true" ]; then
		ARGS="$ARGS -v"
	fi

	db_get wargus/ripcd || true
	if [ "$RET" = "true" ]; then
		ARGS="$ARGS -r"
	fi

	db_stop || true

	wartool $ARGS "$CDPATH" /usr/share/games/stratagus/wargus
	return $?

}

if [ "$1" = "configure" ]; then
	extract || exit $?
fi

#DEBHELPER#

exit 0
