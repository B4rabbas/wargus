#!/bin/sh

set -e

. /usr/share/debconf/confmodule

extract() {

	db_get wargus/extractdata || true

	if [ "$RET" = "true" ]; then

		db_get wargus/cdpath || true

		CDPATH="$RET"
		ARGS=

		if [ -d "$CDPATH" ]; then

			db_get wargus/extractmidi || true
			if [ "$RET" = "true" ]; then
				ARGS="$ARGS -m"
			fi

			db_get wargus/extractvideo || true
			if [ "$RET" = "true" ]; then
				ARGS="$ARGS -v"
			fi

			db_get wargus/ripcd || true
			if [ "$RET" = "true" ]; then
				ARGS="$ARGS -r"
			fi

			db_stop || true
			echo "Extracting data from $CDPATH to /usr/share/games/stratagus/wargus"

			echo wartool $ARGS "$CDPATH" /usr/share/games/stratagus/wargus
			wartool $ARGS "$CDPATH" /usr/share/games/stratagus/wargus
			return $?

		else

			db_stop || true
			echo "${RET} doesn't exist - can't extract Warcraft II data" >&2
			return 1

		fi

	fi

	db_stop || true
	return 0

}

if [ "$1" = "configure" ]; then
	extract || exit $?
fi

#DEBHELPER#

exit 0
