#!/bin/sh
# postinst script for wargus
#
# see: dh_installdeb(1)

set -e

# Maemo section
if [ "`uname -a | grep -is arm`" ] && [ -f /etc/maemo_version ] && [ "$1" == "configure" ]; then
	echo
	echo "Note: You need the original WarCraft II CD (Battle.net edition doesn't work)"
       	echo "to extract the game data files. Data files are needed to run wargus."
	echo
	echo "Run this script to extract data from dir DATA_PATH :"
	echo "/opt/stratagus/share/wargus/build.sh -p DATA_PATH -b /opt/stratagus/bin -o /opt/stratagus/share/wargus -s -c"
	echo
	echo "Or extract data on computer using wargus from"
        echo "https://code.launchpad.net/~pali.rohar/+junk/wargus"
	echo "and copy extracted data to /opt/stratagus/share/wargus"
	echo
	exit 0
fi

# Source debconf library
. /usr/share/debconf/confmodule

case "$1" in
  configure)
      db_get shared/wargusextractdata || true
      if [ "$RET" = "true" ]; then
        db_get shared/warguscdpath || true
        CDPATH=${RET}
        EXTRACTVIDEO=
        EXTRACTMUSIC=
        if [ -d "${CDPATH}" ]; then
          db_get shared/wargusextractvideo || true
          if [ ${RET} = "true" ]; then
            EXTRACTVIDEO="-v"
          fi
          db_get shared/wargusextractmusic || true
          if [ ${RET} = "true" ]; then
            EXTRACTMUSIC="-m"
          fi
          echo "Extracting data from ${CDPATH} to /usr/share/games/stratagus/wargus"
          /usr/share/games/stratagus/wargus/build.sh -p ${CDPATH} -b /usr/games -o /usr/share/games/stratagus/wargus -s -c ${EXTRACTVIDEO} ${EXTRACTMUSIC}
        else
          echo "${RET} doesn't exist - can't extract WarCraft II data" >&2
          exit 1
        fi
      fi
  ;;
  *)
    echo "postinst called with unknown argument \`$1'" >&2
    exit 1
  ;;
esac

db_stop || true

# dh_installdeb will replace this with shell code automatically
# generated by other debhelper scripts.

#DEBHELPER#

exit 0
