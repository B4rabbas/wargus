#!/bin/sh
# postinst script for wargus
#
# see: dh_installdeb(1)

set -e

# Source debconf library
if [ ! -f /etc/maemo_version ]; then
	. /usr/share/debconf/confmodule
fi	

extract() {

	# Maemo section
	if [ -f /etc/maemo_version ]; then
		cd /opt/stratagus/share/wargus
		run-standalone.sh /opt/stratagus/bin/warextract
		return $?
	fi

	db_get wargus/extractdata || true

	if [ "$RET" = "true" ]; then

		db_get wargus/cdpath || true

		CDPATH=${RET}
		EXTRACTVIDEO=
		EXTRACTMUSIC=

		if [ -d "${CDPATH}" ]; then

			db_get wargus/extractvideo || true
			if [ ${RET} = "true" ]; then
				EXTRACTVIDEO="-v"
			fi

			db_get wargus/extractmusic || true
			if [ ${RET} = "true" ]; then
				EXTRACTMUSIC="-m"
			fi

			db_stop || true
			echo "Extracting data from ${CDPATH} to /usr/share/games/stratagus/wargus"

			cd /usr/share/games/stratagus/wargus
			/usr/share/games/stratagus/wargus/build.sh -p ${CDPATH} -b /usr/games -o /usr/share/games/stratagus/wargus -s -c ${EXTRACTVIDEO} ${EXTRACTMUSIC}
			return $?

		else

			db_stop || true
			echo "${RET} doesn't exist - can't extract Warcraft II data" >&2
			return 1

		fi

	fi

	db_stop || true
	return 0

}

case "$1" in
	configure)
		extract
		exit $?
		;;
	*)
		echo "postinst called with unknown argument \`$1'" >&2
		exit 1
		;;
esac

# dh_installdeb will replace this with shell code automatically
# generated by other debhelper scripts.

#DEBHELPER#

exit 0
